---
import { CATEGORIES, COVERAGE } from '../lib/utils';

interface Props {
  currentCategory?: string | null;
  currentCoverage?: string | null;
}

const { currentCategory, currentCoverage } = Astro.props;
---

<div class="filters-container">
  <form method="GET" action="/" class="filters-form">
    <div class="filter-group">
      <label for="category">Category</label>
      <select name="category" id="category">
        <option value="">All Categories</option>
        {Object.entries(CATEGORIES).map(([slug, label]) => (
          <option value={slug} selected={currentCategory === slug}>
            {label}
          </option>
        ))}
      </select>
    </div>

    <div class="filter-group">
      <label for="coverage">Coverage</label>
      <select name="coverage" id="coverage">
        <option value="">All Locations</option>
        {Object.entries(COVERAGE).map(([slug, label]) => (
          <option value={slug} selected={currentCoverage === slug}>
            {label}
          </option>
        ))}
      </select>
    </div>

    <div class="filter-actions">
      <button type="submit" class="btn btn-primary">Apply Filters</button>
      <a href="/" class="btn btn-secondary">Clear</a>
    </div>
  </form>
</div>

<style>
  .filters-container {
    background-color: var(--color-bg-alt);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-lg);
    padding: var(--spacing-lg);
    margin-bottom: var(--spacing-xl);
  }

  .filters-form {
    display: flex;
    gap: var(--spacing-md);
    align-items: flex-end;
    flex-wrap: wrap;
  }

  .filter-group {
    flex: 1;
    min-width: 200px;
    display: flex;
    flex-direction: column;
    gap: var(--spacing-xs);
  }

  .filter-group label {
    font-weight: 500;
    font-size: 0.875rem;
    color: var(--color-text);
  }

  .filter-group select {
    padding: var(--spacing-sm) var(--spacing-md);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-md);
    background-color: var(--color-bg);
    color: var(--color-text);
    font-size: 1rem;
  }

  .filter-group select:focus {
    outline: 2px solid var(--color-primary);
    outline-offset: 2px;
  }

  .filter-actions {
    display: flex;
    gap: var(--spacing-sm);
  }

  @media (max-width: 640px) {
    .filters-form {
      flex-direction: column;
      align-items: stretch;
    }

    .filter-group {
      min-width: 100%;
    }

    .filter-actions {
      flex-direction: column;
    }

    .filter-actions button,
    .filter-actions a {
      width: 100%;
      text-align: center;
    }
  }
</style>

<script>
  // Auto-submit on select change for better UX
  const selects = document.querySelectorAll('.filters-form select');
  selects.forEach(select => {
    select.addEventListener('change', () => {
      const form = select.closest('form');
      if (form) {
        form.submit();
      }
    });
  });
</script>
