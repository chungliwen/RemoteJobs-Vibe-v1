---
import BaseLayout from '../layouts/BaseLayout.astro';
import JobCard from '../components/JobCard.astro';
import JobFilters from '../components/JobFilters.astro';

// Get filter params from URL
const url = new URL(Astro.request.url);
const categoryFilter = url.searchParams.get('category');
const coverageFilter = url.searchParams.get('coverage');

// Load real job data from WeWorkRemotely
const { realJobs } = await import('../scripts/real-jobs.cjs');

// Apply filters
let jobListings = realJobs;
if (categoryFilter) {
  jobListings = jobListings.filter((job: any) => job.category === categoryFilter);
}
if (coverageFilter) {
  jobListings = jobListings.filter((job: any) => job.coverage === coverageFilter);
}

<BaseLayout title="Remote Jobs for Malaysians | RemoteJobs.com.my">
  <div class="container">
    <section class="hero mb-xl">
      <h1>Find Remote Jobs for Malaysians</h1>
      <p class="text-muted">
        Discover remote opportunities from around the world that you're eligible to apply for.
        No work permit required.
      </p>
    </section>

    <section class="jobs-section">
      <h2 class="mb-lg">Latest Jobs</h2>

      <JobFilters currentCategory={categoryFilter} currentCoverage={coverageFilter} />

      {jobListings.length === 0 ? (
        <div class="card">
          <p class="text-muted">
            No jobs available yet. Check back soon!
          </p>
        </div>
      ) : (
        <div class="jobs-grid">
          {jobListings.map((job: any) => (
            <JobCard
              job={job}
              company={{
                id: 1,
                name: job.company_name,
                website: null,
                logo_url: null,
                created_at: ''
              }}
            />
          ))}
        </div>
      )}
    </section>
  </div>
</BaseLayout>

<style>
  .hero {
    text-align: center;
    padding: var(--spacing-2xl) 0;
  }

  .hero h1 {
    font-size: 2.5rem;
    margin-bottom: var(--spacing-md);
    color: var(--color-text);
  }

  .hero p {
    font-size: 1.25rem;
    max-width: 600px;
    margin: 0 auto;
  }

  .jobs-section h2 {
    font-size: 1.75rem;
  }

  .jobs-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: var(--spacing-lg);
  }

  @media (max-width: 640px) {
    .hero h1 {
      font-size: 1.75rem;
    }

    .hero p {
      font-size: 1rem;
    }

    .jobs-grid {
      grid-template-columns: 1fr;
    }
  }
</style>